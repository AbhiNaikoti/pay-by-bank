# SDK Implementation Guide

Follow the appropriate steps to complete. Based on the overall architecture diagram, the Merchant server is required to integrate with the below ConnectPay services exposed through First API (Fiserv's API gateway).

## Overview 
This integration guide provides an overview of steps required to integrate the ConnectPay SDKs and APIs with the merchant’s mobile and web applications. This guide is targeted to be used by technical representatives of a merchant’s mobile/web development team.

ConnectPay is an ACH solution offered by Fiserv’s TeleCheck Platform. This solution offers capabilities for consumers to enroll their bank account(s) with TeleCheck. Each enrolled account is represented by a unique ConnectPay Payment number and token. Either the ConnectPay Payment Number or token can be used by the merchant to make payments in this ACH solution.

This ConnectPay SDK guide provides a drop-in solution for merchants with its own built-in UI and workflow for enrollment use cases. For each use case, the SDK will show end-to-end UI (multi-step, multi- screen) and make ConnectPay API calls in the background to complete the use case. The merchant can choose to use all or just single use case via SDK.

## Pre-Requisites

As part of the Fiserv’s merchant onboarding process, the merchant will be provided with the following:
|       |                                                              |
|-------|--------------------------------------------------------------|
|API Key|This represents the Merchant’s identity to the ConnectPay APIs|
|API Secret|This piece of information helps in authorizing the merchant (using HMAC) to invoke the services on ConnectPay API.It is highly recommended that the merchant should store this value securely (preferably with a strong encryption mechanism) and protect it from unauthorized access. This key should not be stored in client facing application (mobile apps/front end web apps) and never be shared with non-authorized systems and personnel. In the event that this information is compromised, the merchant should immediately notify the Fiserv Team. A new API Key and Secret would be generated and sent to the merchant to be used going forward.|
|Subscriber ID|This represents the Merchant’s account within the TeleCheck system|
|Page Configuration IDs|Each SDK use case is associated with a unique page configuration ID, which is used by the merchant’s mobile app to launch the specific use case.|

API Key, API Secret Subscriber ID and Page Configuration IDs will differ based on the environment provided.The merchant configuration setup will be done by Fiserv within its “FIRSTAPI” gateway for 2 different environments: CAT & Production.
Merchants using Universal Commerce Solution (uCom) will receive an additional set of API Keys and Secret values.

|Environment                |Host                                     |Base Path  |
|---------------------------|-----------------------------------------|-----------|
|Certification API End Point|https://cat.api.firstdata.com/gateway/v2 |/connectpay|
|Production API End Point   |https://prod.api.firstdata.com/gateway/v2|/connectpay|

> Please refer to the following guide that outlines header details that is mandatory prior to making any calls. The prerequisites page can be referred on the [Headers and Encryption](https://qa-developer.fiserv.com/product/ConnectPay/docs/?path=./docs/headersencryptiondecryption.md&branch=develop) here.

## SDK Configurations 
The SDK provides a variety of configurations like the color, theme, field titles, error messages, multi- language (English/Spanish or any language) support, and information to be collected by the user.

Before starting to use the SDKs, the merchant needs to provide their desired configuration offline to Fiserv. The merchant can provide a separate unique configuration for each use case on an individual platform. These configurations will be hosted by Fiserv and used when the SDK is launched from the merchant’s mobile app. The merchant can change these configurations on demand and the changes can take place without the need of SDK binary to be updated.

## SDK Displayed Messages
All messages that will be displayed through the SDKs to the consumers are configurable by merchants. This includes Terms & Conditions. The process for sharing the SDK configurations and consumer messages will be available in the Merchant Guide.

## Tokens
The following is the list of tokens that are generated within Fiserv or the merchant’s applications as part of the ConnectPay roll-out. Reference to these token names will be made in the subsequent sections of the guide.
|          |            |      |
|----------|------------|------|
|Token Name| Description| Notes|
|fdCustomerID|Customer identifier for wallet services|Token type is always generated by Fiserv|
|fdAccountID|Primary SDK payment token. Returned to the Merchant following a consumer enrollment|Token type is always generated by Fiserv| 
|connectPayPaymentNumber|ConnectPay payment number is the card number provisioned in the ConnectPay platform and is linked to the customer’s enrollment (PII data and bank account on file).|Token maybe generated by the Merchant or by the SDK. Ability to receive CP payment number in the clear via secured means will be available in future release|

## Architecture and Flows
The below calls are used in most of the ConnectPay use cases. An overall understanding of these calls is required before doing a deep dive into each use case. Technical details of these calls can be found in later sections of this document.

### Create Consumer Profile
The first step in the enrollment process is to create the fdCustomerId. ConnectPay merchants need to make a server-to-server call to Fiserv to create a unique fdCustomerId for the consumer (if the consumer does not have an existing fdCustomerId) by providing an externalId. ExternalID is a unique attribute on the merchant’s system to identify the consumer. uCom merchants using ConnectPay should be calling the uComAPI for creating the fdCustomerId.

[Consumer Profile](https://qa-developer.fiserv.com/product/ConnectPay/api/?type=post&path=/consumerprofile/add&branch=develop&version=1.0.0)

### Create Session Token
For all functionalities in ConnectPay, the merchant’s server needs to make a server-to-server call to ConnectPay to get a Public Encryption Key and Session Token. The Public Encryption Key would be used in the payload encryption process described later in the document. The Session Token (OAuth2 Token) is a time-limited (10 Minutes duration) token which is sent back to the merchant’s server.

The merchant’s server needs to pass the Public Encryption Key and Session Token to the ConnectPay SDK. The SDK uses the Session Token to authorize itself with ConnectPay for the functional flows and uses the Public Encryption Key for the full payload encryption before the transmission over the network.

[Create Session Token](https://qa-developer.fiserv.com/product/ConnectPay/api/?type=post&path=/security/createsessiontoken&branch=develop&version=1.0.0)

## SDK Use Cases
The ConnectPay SDK comes in three flavors, IOS, Android, and Web.
>Note Please see Next Steps section on the individual flavors.

The SDK should be included into Merchant’s App. When a ConnectPay business use case like Consumer Enrollment, Micro Deposit Validation, Consumer Profile Load from backend, Consumer Updates, and ACH account closure are performed, the Merchant’s App needs to initialize the proper ConnectPay SDK use case and pass necessary data. SDK would do all the orchestration with the ConnectPay backend to complete the business use case.
In case of Consumer Enrollments, Consumer Profile Load, /ConnectPay Payment Number updates, ConnectPay sends back a NONCE as part of the response.

>Note: Since `fdAccountId` is a unique token representing the consumer’s actual payment information, for security reasons this information is not sent back to the SDK/Mobile App. Instead, this information needs to be retrieved by using a NONCE over a secure server-to-server communication channel.

### GetData Call
In the use cases described above where a NONCE is sent back to the Merchant server, the following activities need to be done. The merchant’s server needs to use the NONCE and do a server to server call to ConnectPay through FirstAPI to retrieve the `fdAccountId` generated for this use case. The merchant needs to store/update `fdCustomerId`, `fdAccountId` against the externalId in their system.For any future calls the `fdCustomerId`, `fdAccountId` should be used to interact with the ConnectPay system.

## Next Steps
>Note: Now that you have a basic understanding of the SDK. Here are other Please follow to the common use case landing page to better understand Architecture and next steps

[Common Use Cases](path=./docs/Commonusecaseslanding.md)

Direct Links to flavors of SDK.

[iOS](https://qa-developer.fiserv.com/product/ConnectPay/docs/?path=docs/iossdk.md&branch=develop)

[Android](https://qa-developer.fiserv.com/product/ConnectPay/docs/?path=docs/androidsdk.md&branch=develop)

[WebSDK](https://qa-developer.fiserv.com/product/ConnectPay/docs/?path=docs/websdk.md&branch=develop)